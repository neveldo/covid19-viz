{% extends "base.html" %}

{% block body %}
<section class="jumbotron">
    <div class="container">
        <img src="{{ url_for('static', filename='images/logo.png') }}" width="150px" height="150px"
             style="float:left;margin-right:20px;"/>
        <h1 class="jumbotron-heading">Covid-19 : les données pour la France au {{ max_date }}</h1>

        <p>Cette page permet de visualiser l'évolution des principaux chiffres de la maladie à coronavirus 2019 (COVID-19)
            pour la France : nombre de décès, nouveaux cas, patients hospitalisés, réanimations et guérisons. Les données sont
            mises à jour automatiquement. La source des données est "<a href="https://www.data.gouv.fr/fr/datasets/chiffres-cles-concernant-lepidemie-de-covid19-en-france/#_" target="_blank">Chiffres-clés concernant l'épidémie de COVID19 en France</a>" (data.gouv.fr).
            Le code source de l'application est disponible sur <a href="https://github.com/neveldo/covid19-viz" target="_blank">Github</a>.</p>

    </div>
</section>

<div class="album py-5 bg-light">
    <div class="container">

        <div class="row">

            <div class="col-md-12">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Nombre de décès par jour</h2>
                        <p>Total : <b>{{ counters['death']|int }}</b> au {{ max_date }}</p>
                        <div id="death_chart">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Nombre de cas confirmés par jour</h2>
                        <p>Total : <b>{{ counters['confirmed']|int }}</b> au {{ max_date }}</p>
                        <div id="confirmed_chart">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Nombre de nouveaux patients en réanimation par jour</h2>
                        <p>Total : <b>{{ counters['resuscitation']|int }}</b> au {{ max_date }}</p>
                        <div id="resuscitation_chart">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Nombre de nouvelles hospitalisations par jour</h2>
                        <p>Total : <b>{{ counters['hospitalized']|int }}</b> au {{ max_date }}</p>
                        <div id="hospitalized_chart">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Nombre de patients guéris par jour</h2>
                        <p>Total : <b>{{ counters['healed']|int }}</b> au {{ max_date }}</p>
                        <div id="healed_chart">
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div class="card mb-4 box-shadow">
                    <div class="card-body">
                        <h2>Répartition des décès par département</h2>
                        <div id="death_map">
                            <div class="map"></div>
                            <div class="areaLegend"></div>
                            <div class="plotLegend"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
        $(function() {
            // Init charts
            var plotlyConfig = {
                "locale": "fr",
                "modeBarButtonsToRemove": ["sendDataToCloud", "autoScale2d", "hoverClosestCartesian", "hoverCompareCartesian", "lasso2d", "select2d"],
                "displaylogo": false,
                "showTips": false
            };

            var layout = {};

            {% for chart_name in ['death_chart', 'confirmed_chart', 'resuscitation_chart', 'hospitalized_chart', 'healed_chart'] %}
            Plotly.plot("{{ chart_name }}", {{charts[chart_name] |safe}}, layout, plotlyConfig);
            {% endfor %}

            // Init map
            $("#death_map").mapael({
                map: {
                    name: "france_departments",
                    defaultArea: {
                        attrs: {
                            fill: "#f4f4e8",
                            stroke: "#ced8d0"
                        }
                    }
                },
                legend: {
                    area: {
                        title: "Population of France by department",
                        slices: [
                            {
                                max: 300000,
                                attrs: {
                                    fill: "#97e766"
                                },
                                label: "Less than de 300 000 inhabitants"
                            },
                            {
                                min: 300000,
                                max: 500000,
                                attrs: {
                                    fill: "#7fd34d"
                                },
                                label: "Between 100 000 and 500 000 inhabitants"
                            },
                            {
                                min: 500000,
                                max: 1000000,
                                attrs: {
                                    fill: "#5faa32"
                                },
                                label: "Between 500 000 and 1 000 000 inhabitants"
                            },
                            {
                                min: 1000000,
                                attrs: {
                                    fill: "#3f7d1a"
                                },
                                label: "More than 1 million inhabitants"
                            }
                        ]
                    }
                },
                plots: departments
            });
        });

    </script>
{% endblock %}